<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudPad | Google Drive Edition</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --text: #c9d1d9; --accent: #238636; --border: #30363d; --blue: #58a6ff; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        .toolbar { background: var(--panel); padding: 10px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .logo { font-weight: bold; color: var(--blue); letter-spacing: 1px; font-size: 14px; }
        
        button, input { background: #21262d; color: white; border: 1px solid var(--border); padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: 0.2s; }
        button:hover { background: #30363d; border-color: #8b949e; }
        
        #loginBtn { background: #0078d4; border: none; font-weight: bold; color: white; }
        #saveDriveBtn { background: var(--accent); border: none; font-weight: bold; display: none; }
        
        textarea { flex-grow: 1; background: var(--bg); color: #e6edf3; border: none; padding: 25px; font-size: 18px; font-family: 'Consolas', 'Monaco', monospace; outline: none; resize: none; line-height: 1.6; }
        
        .status-bar { font-size: 12px; padding: 6px 20px; background: var(--panel); color: #8b949e; display: flex; justify-content: space-between; border-top: 1px solid var(--border); }
        #status-text { color: var(--blue); }
    </style>
</head>
<body>

    <div class="toolbar">
        <span class="logo">CLOUDPAD DRIVE</span>
        <button id="loginBtn" onclick="handleAuthClick()">üîë Conectar Google Drive</button>
        <button id="saveDriveBtn" onclick="guardarEnDrive()">‚òÅÔ∏è Guardar en Drive</button>
        <input type="text" id="ext" value=".txt" style="width: 50px; text-align: center;" title="Extensi√≥n personalizada">
        <span class="status-bar" style="border:none; background:transparent; margin-left:auto;">
            <span id="status-text">Desconectado</span>
        </span>
    </div>

    <textarea id="editor" placeholder="Escribe aqu√≠ tus notas... Se guardar√°n localmente hasta que las subas a Drive."></textarea>

    <div class="status-bar">
        <span>¬© 2026 CloudPad Pro - 0MB en Disco</span>
        <span id="char-count">Caracteres: 0</span>
    </div>

    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <script>
        // CREDENCIALES INTEGRADAS
        const CLIENT_ID = '565820507464-v1skrihu7npm106vg52tm9tjcfjb1an9.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyDaRRsfvcG4FTzBYDiKPnNYD5-C_VP40qc';
        
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        function gapiLoaded() { gapi.load('client', async () => { await gapi.client.init({ apiKey: API_KEY, discoveryDocs: [DISCOVERY_DOC] }); gapiInited = true; }); }
        function gisLoaded() { tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: SCOPES, callback: '' }); gisInited = true; }

        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) throw (resp);
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('saveDriveBtn').style.display = 'block';
                document.getElementById('status-text').innerText = "CONECTADO A DRIVE";
                document.getElementById('status-text').style.color = "#2ea043";
            };
            tokenClient.requestAccessToken({prompt: 'consent'});
        }

        async function guardarEnDrive() {
            const status = document.getElementById('status-text');
            status.innerText = "SUBIENDO...";
            
            const contenido = document.getElementById('editor').value;
            const extension = document.getElementById('ext').value;
            const nombre = "nota_nube_" + Date.now() + (extension.startsWith('.') ? extension : '.' + extension);
            
            const metadata = { 'name': nombre, 'mimeType': 'text/plain' };
            const file = new Blob([contenido], {type: 'text/plain'});
            
            try {
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
                form.append('file', file);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + gapi.client.getToken().access_token }),
                    body: form
                });

                if (response.ok) {
                    status.innerText = "¬°GUARDADO EN DRIVE!";
                    setTimeout(() => { status.innerText = "CONECTADO"; }, 3000);
                } else { throw new Error(); }
            } catch (err) {
                status.innerText = "ERROR AL GUARDAR";
                status.style.color = "#f85149";
            }
        }

        // Sistema de respaldo local y m√©tricas
        const editor = document.getElementById('editor');
        editor.addEventListener('input', () => {
            localStorage.setItem('cloudpad_temp', editor.value);
            document.getElementById('char-count').innerText = "Caracteres: " + editor.value.length;
        });
        window.onload = () => { 
            editor.value = localStorage.getItem('cloudpad_temp') || ""; 
            document.getElementById('char-count').innerText = "Caracteres: " + editor.value.length;
        };
    </script>
</body>
</html>